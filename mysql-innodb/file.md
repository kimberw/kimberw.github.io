# 文件

## 参数文件

数据库加载时需要读取的配置文件，分为动态和静态两类。动态可以在运行时修改。静态在运行时只读。

## 日志文件

### 错误日志

数据库运行时出现异常，错误，警告时会写入错误日志。方便 DBA 快速掌握数据库当前状态，了解发生的什么类型错误，以及如何解决。

### 慢查询日志

通过设置参数，可以将查询时间超过配置的数据查询语句记录在慢查询日志中。同样也可以修改配置，将未使用索引查询的语句记录在日志中。方便 DBA 优化查询语句。

### 查询日志

记录所有的数据库请求。包括未能真正执行的语句（类似：access denied）。

### 二进制日志

记录数据库执行的所有更改操作，包括未实现任何修改的更新操作，但不包括 select show 等显示查询操作。

#### 主要作用

- 恢复 recovery：某些数据恢复需要使用二进制日志
- 复制 replication：通过复制和执行二进制日志使一台 slave 与 一台 master 进行实时同步
- 审计 audit：用户可以通过二进制日志中的信息来进行审计，判断是否有对数据库进行注入的攻击

InnoDB 引擎会将所有未提交的二进制日志记录到一个缓存中，等待该事务提交时将缓存写入到二进制日志文件。该缓存大小不易设置过大，因为每个事务都会分配一个 binlog_cache_size 大小的缓存。又不能设置过小，若事务记录大于该值，mysql 会将缓存写入到临时文件中。

二进制日志文件并不是每次写的时候都同步到磁盘（缓冲写），若数据库所在操作系统发生宕机，可能会有一部分数据未真正写入二进制文件，对于恢复和复制带来问题。也可以将每多次操作同步到磁盘的值，设置为1。即每次写缓冲都会同步到磁盘，这种情况可以保证高可用性，但是对数据库 IO 带来一定影响。

#### binlog_format

- STATEMENT 记录日志的逻辑SQL语句，READ COMMITED 可能会出现主从不一致的问题。
- ROW 记录的是表的行更改情况，可靠性更高，需要容量更大
- MIXED 使用STATEMENT 格式记录二进制日志文件，但是对于部分情况使用ROW格式。

## 套接字文件

管理套接字的文件。

## pid 文件

mysql 启动时会将进程id 写入到一个文件中。

## 表结构定义文件

mysql插件式存储引擎的体系结构。mysql 数据的存储是根据表进行的。每个表都有与之对应的文件，以frm为后缀，记录着该表的表结构定义。

## InnoDB 存储引擎文件

### 表空间文件

InnoDB 存储的数据按表空间进行存放

### 重做日志文件

重做日志写入磁盘是按512字节，即一个扇区的大小写入的，可以保证写入必定成功，不需要doublewrite。

写磁盘的时机

1. 主线程每秒定时写入磁盘
2. 触发的方式，innodb_flush_log_at_trx_commit 分为3种级别
   1. 0：commit时不写磁盘，等待主线程每秒刷新
   2. 1： 每次commit时将重做日志缓冲同步到磁盘，并伴有 fsync
   3. 2：重做日志异步写到磁盘，即写入文件系统缓存，不做fsync，不能保证执行commit时肯定会写入重做日志文件